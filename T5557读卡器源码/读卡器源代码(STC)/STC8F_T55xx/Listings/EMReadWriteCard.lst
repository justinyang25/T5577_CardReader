C51 COMPILER V9.55   EMREADWRITECARD                                                       04/30/2021 14:43:22 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE EMREADWRITECARD
OBJECT MODULE PLACED IN .\Objects\EMReadWriteCard.obj
COMPILER INVOKED BY: C:\Program Files\Keil_v5\C51\BIN\C51.EXE Scr\EMReadWriteCard.c BROWSE INCDIR(.\Header) DEBUG OBJECT
                    -EXTEND PRINT(.\Listings\EMReadWriteCard.lst) TABS(2) OBJECT(.\Objects\EMReadWriteCard.obj)

line level    source

   1          #include"EMReadWriteCard.h"
   2          #include"Uart.h"
   3          
   4          ///////////////////////////////////////////////////////////////////
   5          //                        Ð´¿¨Ê±¼ä²ÎÊýus
   6          #define   Start_Gap     55    //¿ªÊ¼¼äÏ¶  
   7          #define   Write_Data1   32    //Ð´Êý¾Ý'1'
   8          #define   Write_DataH0  17    //Ð´Êý¾Ý'0'17 
   9          #define   Write_DataL0  23    //Ð´Êý¾Ý'0'23
  10          
  11          #define WriteCom    0x05         //Ð´ÃüÁî
  12          
  13          
  14          unsigned char EM_Buff[10];    //¶Á¿¨Êý¾Ý½ÓÊÕ»º³å
  15          
  16          void Delay_8nus(unsigned int n)
  17          {
  18   1          unsigned char i;
  19   1        
  20   1          do
  21   1          {
  22   2              i = 58;
  23   2              while (--i);
  24   2          }
  25   1          while(n--);  
  26   1      }
  27          
  28          //========================================================================
  29          // º¯Êý: void Write_bit(unsigned char x)
  30          // ÃèÊö: Ð´Ò»¸öÊý¾ÝÎ»
  31          // ²ÎÊý: x£ºÐ´ÈëµÄÊý¾Ý 0/1
  32          // ·µ»Ø: 
  33          // °æ±¾: V1.0, 2017-9-23
  34          //========================================================================
  35          void Write_bit(unsigned char x)
  36          {
  37   1          if(x)
  38   1          {
  39   2              Carrier_On();             //¿ª´Å³¡
  40   2              Delay_8nus(Write_Data1);  //Î¬³ÖÊý¾Ý1µÄ´Å³¡Ê±¼ä
  41   2          }
  42   1          else
  43   1          {
  44   2              Carrier_On();             //¿ª´Å³¡
  45   2              Delay_8nus(Write_DataH0); //Î¬³ÖÊý¾Ý0µÄ¿ªÆô´Å³¡Ê±¼ä
  46   2              Carrier_Off();            //¹Ø±Õ´Å³¡
  47   2              Delay_8nus(Write_DataL0); //Î¬³ÖÊý¾Ý0µÄ¹Ø±Õ´Å³¡Ê±¼ä   
  48   2              Carrier_On();             //¿ª´Å³¡      
  49   2          } 
  50   1      }
  51          
  52          //========================================================================
  53          // º¯Êý: void Write_star(void)
  54          // ÃèÊö: ·¢ÆðÊ¼ÐÅºÅ
C51 COMPILER V9.55   EMREADWRITECARD                                                       04/30/2021 14:43:22 PAGE 2   

  55          // ²ÎÊý: 
  56          // ·µ»Ø: 
  57          // °æ±¾: V1.0, 2017-9-23
  58          //========================================================================
  59          void Write_star(void)
  60          { 
  61   1          Carrier_Off();
  62   1          Delay_8nus(Start_Gap);      //¿ªÆô³¡Ç¿410us
  63   1          Write_bit(0);
  64   1      }
  65          
  66          //========================================================================
  67          // º¯Êý: void Write_command(unsigned char command)
  68          // ÃèÊö: Ð´ÃüÁî×Ö
  69          // ²ÎÊý: command  Ð´£º0101 ¶Á£º1001 µÇÂ¼£º0011 ±£»¤£º1100 ½ûÓÃ£º1010º
  70          // ·µ»Ø: 
  71          // °æ±¾: V1.0, 2017-9-23
  72          //========================================================================
  73          void Write_command(unsigned char command)
  74          {
  75   1          unsigned char i;
  76   1          unsigned char mask = 0x08;
  77   1      
  78   1          for(i=0;i<4;i++)                
  79   1          {
  80   2              Write_bit(mask & command);         
  81   2              mask >>= 1;
  82   2          } 
  83   1      }
  84          
  85          //========================================================================
  86          // º¯Êý: void Write_Data(unsigned char dat)
  87          // ÃèÊö: Ð´Êý¾Ý
  88          // ²ÎÊý: dat Ð´ÈëµÄÖµ
  89          // ·µ»Ø: 
  90          // °æ±¾: V1.0, 2017-9-23
  91          //========================================================================
  92          void Write_Data(unsigned char dat)
  93          {
  94   1          unsigned char i;            //1f 0001 1111 1
  95   1          unsigned char num = 0;
  96   1          unsigned char mask = 0x01;  
  97   1      
  98   1          for(i=0;i<8;i++)
  99   1          {
 100   2              Write_bit(mask & dat);
 101   2              mask <<= 1; 
 102   2          }
 103   1          for(i=0;i<8;i++)            //¼ÆËãÐ£ÑéÎ»
 104   1          {
 105   2              dat <<= 1;
 106   2              if(CY) num++;
 107   2          }
 108   1          if((num%2)==0)              //ÆæÊý¸ö1 
 109   1              Write_bit(0);           //·¢ËÍÐ£ÑéÎ»
 110   1          else
 111   1              Write_bit(1);   
 112   1      }
 113          
 114          //========================================================================
 115          // º¯Êý: void Write_JY(unsigned char dat) 
 116          // ÃèÊö: Ð´ÁÐÐ£Ñé
C51 COMPILER V9.55   EMREADWRITECARD                                                       04/30/2021 14:43:22 PAGE 3   

 117          // ²ÎÊý: dat Ð´ÈëµÄÖµ
 118          // ·µ»Ø: 
 119          // °æ±¾: V1.0, 2017-9-23
 120          //========================================================================
 121          void Write_JY(unsigned char dat)     
 122          {
 123   1          unsigned char i;
 124   1          unsigned char mask = 0x01;
 125   1      
 126   1          for(i=0;i<8;i++)
 127   1          {
 128   2            Write_bit(mask & dat);
 129   2            mask <<= 1; 
 130   2          }   
 131   1      }
 132          
 133          //========================================================================
 134          // º¯Êý: void Write_Address(unsigned char add)
 135          // ÃèÊö: Ð´ÉÈÇøµØÖ·
 136          // ²ÎÊý: add µØÖ·
 137          // ·µ»Ø: 
 138          // °æ±¾: V1.0, 2017-9-23
 139          //========================================================================
 140          void Write_Address(unsigned char add)
 141          {
 142   1          unsigned char i;
 143   1          unsigned char dat;
 144   1          unsigned char mask = 0x01;  //0010 0000
 145   1          unsigned char num = 0;
 146   1      
 147   1          dat = add&0x0f;             //Çå¸ß4bit
 148   1      
 149   1          for(i=0;i<4;i++)
 150   1          {
 151   2              dat = dat>>1;
 152   2              if(CY) num++;           //¼ÆËã¼ìÑé
 153   2          }
 154   1          for(i=0;i<6;i++)            //·¢ËÍµØÖ·
 155   1          {
 156   2              Write_bit(mask & add);  
 157   2              mask <<= 1; 
 158   2          }                           //·¢ËÍÐ£ÑéÖµ
 159   1          if(num%2==0)
 160   1              Write_bit(0);       
 161   1          else
 162   1              Write_bit(1);
 163   1      }
 164          
 165          //========================================================================
 166          // º¯Êý: void Write_block(unsigned char dat0,unsigned char dat1,unsigned char dat2,unsigned char dat3,unsi
             -gned char block)
 167          // ÃèÊö: ÉÈÇø¿éÐ´
 168          // ²ÎÊý: Êý¾Ý£ºdat0£¬dat1£¬dat2£¬dat3£¬ ¿éµØÖ·£ºblock£¨0-15£©
 169          // ·µ»Ø: 
 170          // °æ±¾: V1.0, 2017-9-23
 171          //========================================================================
 172          void Write_block(unsigned char dat0,unsigned char dat1,unsigned char dat2,unsigned char dat3,unsigned char
             - block)
 173          {
 174   1          unsigned char i,j,k;
 175   1          unsigned char Buff_x[5];
 176   1      
C51 COMPILER V9.55   EMREADWRITECARD                                                       04/30/2021 14:43:22 PAGE 4   

 177   1          Buff_x[3] = dat0;
 178   1          Buff_x[2] = dat1;
 179   1          Buff_x[1] = dat2;
 180   1          Buff_x[0] = dat3;
 181   1        
 182   1          for(i=0;i<8;i++)
 183   1          { 
 184   2              j = 0; 
 185   2              Buff_x[4] = Buff_x[4]<<1;
 186   2              for(k=0;k<4;k++)                      //¼ÆËãÁÐÐ£Ñé
 187   2              {
 188   3                switch(i)
 189   3                {
 190   4                  case 0: j=j ^ (Buff_x[k]&0x80);
 191   4                      break;
 192   4                  case 1: j=j ^ (Buff_x[k]&0x40);
 193   4                      break;
 194   4                  case 2: j=j ^ (Buff_x[k]&0x20);
 195   4                      break;
 196   4                  case 3: j=j ^ (Buff_x[k]&0x10);
 197   4                      break;
 198   4                  case 4: j=j ^ (Buff_x[k]&0x08);
 199   4                      break;
 200   4                  case 5: j=j ^ (Buff_x[k]&0x04);
 201   4                      break;
 202   4                  case 6: j=j ^ (Buff_x[k]&0x02);
 203   4                      break;
 204   4                  case 7: j=j ^ (Buff_x[k]&0x01);
 205   4                      break;                                                                                
 206   4                }
 207   3              }
 208   2              if(j!=0)
 209   2                Buff_x[4] = Buff_x[4]|0x01;     
 210   2          } 
 211   1          Write_star();             //Ð´ÆðÊ¼ÐÅºÅ
 212   1      
 213   1          Write_command(WriteCom);  //·¢ËÍÐ´ÃüÁî  0101
 214   1          Write_Address(block);     //·¢ËÍÐ´ÈëµÄµØÖ·
 215   1      
 216   1          for(i=0;i<4;i++)          //Ð´Êý¾Ý
 217   1              Write_Data(Buff_x[i]);
 218   1          Write_JY(Buff_x[4]);      //Ð´ÁÐÐ£Ñé
 219   1          Write_bit(0);             //Ð´½áÊø·û¡°0¡±
 220   1      }
 221          
 222          
 223          
 224          
 225          
 226          
 227          
 228          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    444    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.55   EMREADWRITECARD                                                       04/30/2021 14:43:22 PAGE 5   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
